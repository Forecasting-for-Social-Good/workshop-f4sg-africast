<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-10-23">

<title>F4SG: Africast - Exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/fable.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<meta name="twitter:title" content="F4SG: Africast - Exercises">
<meta name="twitter:description" content="<span class='code'>Check with your mentor on Slack</span>">
<meta name="twitter:image" content="https://workshop.f4sg.org/africast/images/twitter-card.png">
<meta name="twitter:creator" content="@mitchoharawild">
<meta name="twitter:image-height" content="654">
<meta name="twitter:image-width" content="1250">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">F4SG: Africast</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sessions" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Sessions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sessions">    
        <li>
    <a class="dropdown-item" href="../../sessions/day1/basics.html">
 <span class="dropdown-text">Basics of time series and data structures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day1/graphics.html">
 <span class="dropdown-text">Time series patterns and basic graphics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day2/adjustments.html">
 <span class="dropdown-text">Recap day 1, transforming / adjusting time series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day2/features.html">
 <span class="dropdown-text">Computing and visualizing features (features)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day3/forecasting.html">
 <span class="dropdown-text">Basic modeling / forecasting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day3/regressors.html">
 <span class="dropdown-text">Forecasting with regression, how to represent temporal structure with regressors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day4/ets.html">
 <span class="dropdown-text">ETS, building on recap of temporal regressors.</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day4/arima.html">
 <span class="dropdown-text">ARIMA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day5/accuracy.html">
 <span class="dropdown-text">Recap forecasting methods, basic training and test accuracy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day5/diagnostics.html">
 <span class="dropdown-text">Advanced performance evaluation: residual diagnostics and cross validation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-downloads" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-download" role="img">
</i> 
 <span class="menu-text">Downloads</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-downloads">    
        <li>
    <a class="dropdown-item" href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa/archive/refs/heads/master.zip">
 <span class="dropdown-text">Everything</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../slides.zip">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../exercises.zip">
 <span class="dropdown-text">Lab sessions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../license.html"><i class="bi bi-file-certificate" role="img">
</i> 
 <span class="menu-text">License</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#set-up" id="toc-set-up" class="nav-link active" data-scroll-target="#set-up">Set-up</a></li>
  <li><a href="#learn" id="toc-learn" class="nav-link" data-scroll-target="#learn">Learn</a>
  <ul class="collapse">
  <li><a href="#creating-a-time-series-tibble-a-tsibble" id="toc-creating-a-time-series-tibble-a-tsibble" class="nav-link" data-scroll-target="#creating-a-time-series-tibble-a-tsibble">Creating a time series tibble (a tsibble!)</a></li>
  <li><a href="#manipulating-time-series" id="toc-manipulating-time-series" class="nav-link" data-scroll-target="#manipulating-time-series">Manipulating time series</a></li>
  <li><a href="#visualising-time-series" id="toc-visualising-time-series" class="nav-link" data-scroll-target="#visualising-time-series">Visualising time series</a>
  <ul class="collapse">
  <li><a href="#time-plots" id="toc-time-plots" class="nav-link" data-scroll-target="#time-plots">Time plots</a></li>
  <li><a href="#seasonal-plots" id="toc-seasonal-plots" class="nav-link" data-scroll-target="#seasonal-plots">Seasonal plots</a></li>
  <li><a href="#seasonal-subseries-plot" id="toc-seasonal-subseries-plot" class="nav-link" data-scroll-target="#seasonal-subseries-plot">Seasonal subseries plot</a></li>
  <li><a href="#acf-plots" id="toc-acf-plots" class="nav-link" data-scroll-target="#acf-plots">ACF plots</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#apply" id="toc-apply" class="nav-link" data-scroll-target="#apply">Apply</a>
  <ul class="collapse">
  <li><a href="#about-the-dataset" id="toc-about-the-dataset" class="nav-link" data-scroll-target="#about-the-dataset">About the dataset</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa/edit/main/sessions/day1/exercises.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exercises</h1>
<p class="subtitle lead"><span class="code">Check with your mentor on Slack</span></p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Date</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 23, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="set-up" class="level1">
<h1>Set-up</h1>
<p>Weâ€™ve prepared an exercises project with some starter code for each of the sessions. You can download and open this project using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_course</span>(<span class="st">"https://workshop.f4sg.org/africast/exercises.zip"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="learn" class="level1">
<h1>Learn</h1>
<section id="creating-a-time-series-tibble-a-tsibble" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-time-series-tibble-a-tsibble">Creating a time series tibble (a tsibble!)</h2>
<p>A <code>tsibble</code> is a rectangular data frame that contains:</p>
<ul>
<li>a time column: the <code>index</code></li>
<li>identifying column(s): the <code>key</code> variables</li>
<li>values (the measured variables)</li>
</ul>
<p>You usually create a <code>tsibble</code> by converting an existing dataset (read from a file) with <code>as_tsibble()</code>. For example, letâ€™s look at the production of rice in Guinea.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the dataset using readr</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>guinea_rice <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/guinea_rice.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the dataset to a tsibble</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Here the index variable is 'Year', and there are no key variables.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The 'Production' variable is what we're interested in forecasting (the measured variable).</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>guinea_rice <span class="ot">&lt;-</span> <span class="fu">as_tsibble</span>(guinea_rice, <span class="at">index =</span> Year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A <code>tsibble</code> enables time-aware data manipulation, which makes it easy to work with time series. It also has extra checks to prevent common errors, while these can be frustrating at first they are important in correctly analysing your data.</p>
<p>There are two common mistakes when creating a <code>tsibble</code>, which weâ€™ll see in the next example of Australian accommodation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the dataset using readr</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aus_accommodation.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to convert the dataset to a tsibble</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="ot">&lt;-</span> <span class="fu">as_tsibble</span>(aus_accommodation, <span class="at">index =</span> Date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `validate_tsibble()`:
! A valid tsibble must have distinct rows identified by key and index.
â„¹ Please use `duplicates()` to check the duplicated rows.</code></pre>
</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
That didnâ€™t workâ€¦
</div>
</div>
<div class="callout-body-container callout-body">
<p>Reading the error says we have â€˜duplicated rowsâ€™. What this means is that we have two or more rows in the dataset for the <strong>same point in time</strong>. In time series it isnâ€™t possible to get two different values at the same time, but it is possible to measure <strong>several different things</strong> at the same time.</p>
</div>
</div>
<p>When you get this error, consider if any of the datasetâ€™s variables can identify individual series.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The identifying <strong>key variables</strong> of a time series are usually <strong>character variables</strong>, and the measured variables are almost always numeric.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 592 Ã— 5
   Date       State                        Takings Occupancy   CPI
   &lt;date&gt;     &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 1998-01-01 Australian Capital Territory    24.3      65    67  
 2 1998-04-01 Australian Capital Territory    22.3      59    67.4
 3 1998-07-01 Australian Capital Territory    22.5      58    67.5
 4 1998-10-01 Australian Capital Territory    24.4      59    67.8
 5 1999-01-01 Australian Capital Territory    23.7      58    67.8
 6 1999-04-01 Australian Capital Territory    25.4      61    68.1
 7 1999-07-01 Australian Capital Territory    28.2      66    68.7
 8 1999-10-01 Australian Capital Territory    25.8      60    69.1
 9 2000-01-01 Australian Capital Territory    27.3      60.9  69.7
10 2000-04-01 Australian Capital Territory    30.1      64.7  70.2
# â„¹ 582 more rows</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which of these variable(s) identifies each time series?</p>
</div>
</div>
<p>In this dataset we have accommodation data from all 8 states in Australia, and so we need to specify <code>State</code> as a key variable when creating our tsibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to convert the dataset to a tsibble</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="ot">&lt;-</span> <span class="fu">as_tsibble</span>(aus_accommodation, <span class="at">index =</span> Date, <span class="at">key =</span> State)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>aus_accommodation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 592 x 5 [1D]
# Key:       State [8]
   Date       State                        Takings Occupancy   CPI
   &lt;date&gt;     &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 1998-01-01 Australian Capital Territory    24.3      65    67  
 2 1998-04-01 Australian Capital Territory    22.3      59    67.4
 3 1998-07-01 Australian Capital Territory    22.5      58    67.5
 4 1998-10-01 Australian Capital Territory    24.4      59    67.8
 5 1999-01-01 Australian Capital Territory    23.7      58    67.8
 6 1999-04-01 Australian Capital Territory    25.4      61    68.1
 7 1999-07-01 Australian Capital Territory    28.2      66    68.7
 8 1999-10-01 Australian Capital Territory    25.8      60    69.1
 9 2000-01-01 Australian Capital Territory    27.3      60.9  69.7
10 2000-04-01 Australian Capital Territory    30.1      64.7  70.2
# â„¹ 582 more rows</code></pre>
</div>
</div>
<p>Hurray, we have a <code>tsibble</code>! <span class="emoji" data-emoji="tada">ðŸŽ‰</span></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
However thereâ€™s still one thing that isnâ€™t rightâ€¦
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the first row of the output we see [1D] - this means that the frequency of the data is <strong>daily</strong>.</p>
</div>
</div>
<p>Looking at the index column (<code>Date</code>), we can see that each point in time is three months apart - or <strong>quarterly</strong>. This is another common mistake when working with time series, you need to set the appropriate <em>temporal granularity</em>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
What is temporal granularity?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Temporal granularity is the resolution in time. The time variable needs to match this resolution.</p>
<p>In this example, a date was used to represent quarters, but instead we must use <code>yearquarter()</code> to match the temporal granularity.</p>
<p>Hereâ€™s a helpful list of common granularities:</p>
<ul>
<li><code>as.integer()</code>: annual data (as above)</li>
<li><code>yearquarter()</code>: Quarterly data (shown here)</li>
<li><code>yearmonth()</code>: Monthly data</li>
<li><code>yearweek()</code>: Weekly data</li>
<li><code>as.Date()</code>: Daily data</li>
<li><code>as.POSIXct()</code>: Sub-daily data</li>
</ul>
</div>
</div>
<p>To use the appropriate temporal granularity, we first must change our <code>Date</code> column before creating the tsibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the `Date` column to quarterly with dplyr</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="ot">&lt;-</span> aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">yearquarter</span>(Date)) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Date, <span class="at">key =</span> State)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>aus_accommodation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 592 x 5 [1Q]
# Key:       State [8]
      Date State                        Takings Occupancy   CPI
     &lt;qtr&gt; &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 1998 Q1 Australian Capital Territory    24.3      65    67  
 2 1998 Q2 Australian Capital Territory    22.3      59    67.4
 3 1998 Q3 Australian Capital Territory    22.5      58    67.5
 4 1998 Q4 Australian Capital Territory    24.4      59    67.8
 5 1999 Q1 Australian Capital Territory    23.7      58    67.8
 6 1999 Q2 Australian Capital Territory    25.4      61    68.1
 7 1999 Q3 Australian Capital Territory    28.2      66    68.7
 8 1999 Q4 Australian Capital Territory    25.8      60    69.1
 9 2000 Q1 Australian Capital Territory    27.3      60.9  69.7
10 2000 Q2 Australian Capital Territory    30.1      64.7  70.2
# â„¹ 582 more rows</code></pre>
</div>
</div>
<p>Now we have a tsibble thatâ€™s ready to use! In the first row of the output you should now see <code>[1Q]</code> indicating that the data is quarterly. You can also see the second row shows us our key variable, <code>State</code>. Next to this is <code>[8]</code>, which tells us that this dataset contains 8 time series (one for each of Australiaâ€™s states).</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Pipes
</div>
</div>
<div class="callout-body-container callout-body">
<p>When chaining together multiple functions, itâ€™s helpful to use the pipe operator (<code>|&gt;</code>).</p>
<p>The pipe allows you to read the functions in the order that they are used - much like a sentence!</p>
<p><em>More information is here: <a href="https://r4ds.hadley.nz/workflow-style.html#sec-pipes" class="uri">https://r4ds.hadley.nz/workflow-style.html#sec-pipes</a></em></p>
</div>
</div>
<p>Thatâ€™s all you need to know about creating a tidy time series <em>tsibble</em> <span class="emoji" data-emoji="rainbow">ðŸŒˆ</span>.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a tsibble for the number of tourists visiting Australia contained in <code>data/tourism.csv</code>.</p>
<p>Some starter code has been provided for you in the day 1 exercises.</p>
<p><em>Hint</em>: this dataset contains multiple key variables that need to be used together. You can specify multiple keys with <code>as_tsibble(key = c(a, b, c))</code>.</p>
</div>
</div>
</section>
<section id="manipulating-time-series" class="level2">
<h2 class="anchored" data-anchor-id="manipulating-time-series">Manipulating time series</h2>
<p>Often you want to work with specific series, or perhaps the sum up the values across multiple series. We can use the same <code>dplyr</code> functions that are used in data analysis to explore our time series. Letâ€™s focus on a single state from the Australian accommodation example - here we use <code>filter()</code> to keep only the Queensland data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Queensland"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 74 x 5 [1Q]
# Key:       State [1]
      Date State      Takings Occupancy   CPI
     &lt;qtr&gt; &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 1998 Q1 Queensland    230.      54    67  
 2 1998 Q2 Queensland    219.      54    67.4
 3 1998 Q3 Queensland    268.      64    67.5
 4 1998 Q4 Queensland    279.      61    67.8
 5 1999 Q1 Queensland    241.      55    67.8
 6 1999 Q2 Queensland    235.      56    68.1
 7 1999 Q3 Queensland    286.      65    68.7
 8 1999 Q4 Queensland    288.      61    69.1
 9 2000 Q1 Queensland    253.      54.7  69.7
10 2000 Q2 Queensland    253.      56.5  70.2
# â„¹ 64 more rows</code></pre>
</div>
</div>
<p>Maybe we wanted to focus on the more recent data, only keeping observations after 2010. Note that multiple conditions (both time and place) can be included inside a single <code>filter()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Queensland"</span>, Date <span class="sc">&gt;=</span> <span class="fu">yearquarter</span>(<span class="st">"2010 Q1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 26 x 5 [1Q]
# Key:       State [1]
      Date State      Takings Occupancy   CPI
     &lt;qtr&gt; &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 2010 Q1 Queensland    464.      57.4  95.2
 2 2010 Q2 Queensland    461.      58.5  95.8
 3 2010 Q3 Queensland    573.      68.9  96.5
 4 2010 Q4 Queensland    562.      64.8  96.9
 5 2011 Q1 Queensland    471.      58.1  98.3
 6 2011 Q2 Queensland    489.      61    99.2
 7 2011 Q3 Queensland    592.      70.5  99.8
 8 2011 Q4 Queensland    587.      66.9  99.8
 9 2012 Q1 Queensland    530.      62.3  99.9
10 2012 Q2 Queensland    519.      62.6 100. 
# â„¹ 16 more rows</code></pre>
</div>
</div>
<p>Letâ€™s try seeing the total accommodation <code>Takings</code> and <code>Occupancy</code> for all of Australia. For this, we can use the <code>summarise()</code> function to summarise information across multiple rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Takings =</span> <span class="fu">sum</span>(Takings), <span class="at">Occupancy =</span> <span class="fu">sum</span>(Occupancy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 74 x 3 [1Q]
      Date Takings Occupancy
     &lt;qtr&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 1998 Q1    949.      469 
 2 1998 Q2    875.      431 
 3 1998 Q3    981.      458 
 4 1998 Q4   1036.      468 
 5 1999 Q1    997.      460 
 6 1999 Q2    940.      447 
 7 1999 Q3   1062.      481 
 8 1999 Q4   1105.      474 
 9 2000 Q1   1088.      465.
10 2000 Q2   1039.      460.
# â„¹ 64 more rows</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The <code>index</code> and summarise()
</div>
</div>
<div class="callout-body-container callout-body">
<p>We still have our <code>Date</code> variable as it is automatically grouped when working with tsibble.</p>
</div>
</div>
<p>What about calculating the annual takings, not quarterly? For this we use a special grouping function called <code>index_by()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">index_by</span>(<span class="at">Year =</span> <span class="fu">year</span>(Date)) <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Takings =</span> <span class="fu">sum</span>(Takings), <span class="at">Occupancy =</span> <span class="fu">sum</span>(Occupancy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 19 x 3 [1Y]
    Year Takings Occupancy
   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1  1998   3841.     1826 
 2  1999   4104.     1862 
 3  2000   4725.     1834.
 4  2001   4766.     1819.
 5  2002   4865.     1848 
 6  2003   5277.     1887.
 7  2004   5675.     1950.
 8  2005   6189.     1996.
 9  2006   6783.     2054.
10  2007   7443.     2107.
11  2008   7897.     2074.
12  2009   7629.     2024.
13  2010   8088.     2081 
14  2011   8534.     2089.
15  2012   8965.     2088 
16  2013   8992.     2048.
17  2014   9477.     2031.
18  2015  10242.     2069.
19  2016   5080.     1034.</code></pre>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the <code>tourism</code> dataset, create an <strong>annual</strong> time series of the <code>Purpose</code> of travel for visitors to Australia (summing over <code>State</code> and <code>Region</code>)</p>
<p>Some starter code has been provided for you in the day 1 exercises.</p>
<p><em>Hint</em>: think about which key variables should be kept with <code>group_by()</code>, and how the index should be changed using <code>index_by()</code> then <code>summarise()</code>.</p>
</div>
</div>
<p>What if we didnâ€™t want a time series at all? To calculate the total takings over all of time, we convert back to an ordinary data frame with <code>as_tibble()</code> and then <code>summarise()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Takings =</span> <span class="fu">sum</span>(Takings), <span class="at">Occupancy =</span> <span class="fu">sum</span>(Occupancy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 2
  Takings Occupancy
    &lt;dbl&gt;     &lt;dbl&gt;
1 128571.    36720.</code></pre>
</div>
</div>
<p>Which state has had the most accommodation takings in 2010? Letâ€™s calculate total takings by state for 2010, and sort them with <code>arrange()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Date) <span class="sc">==</span> <span class="dv">2010</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Takings =</span> <span class="fu">sum</span>(Takings), <span class="at">Occupancy =</span> <span class="fu">sum</span>(Occupancy)) <span class="sc">|&gt;</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Takings))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 Ã— 3
  State                        Takings Occupancy
  &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt;
1 New South Wales                2595.      259.
2 Queensland                     2061.      250.
3 Victoria                       1517.      258.
4 Western Australia               849.      259.
5 South Australia                 381.      252.
6 Northern Territory              265.      262.
7 Australian Capital Territory    227.      304.
8 Tasmania                        193.      238.</code></pre>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the <code>tourism</code> dataset, which <code>Purpose</code> of travel is most common in each state?</p>
<p>Some starter code has been provided for you in the day 1 exercises.</p>
<p><em>Hint</em>: since you no longer want to consider changes over time, youâ€™ll need to convert the data back to a <code>tibble</code>.</p>
</div>
</div>
</section>
<section id="visualising-time-series" class="level2">
<h2 class="anchored" data-anchor-id="visualising-time-series">Visualising time series</h2>
<p>There are a few common visualisation techniques specific to time series, however cross-sectional graphics also work well for time series data. The main difference is that we like to maintain the ordered and connected nature of time.</p>
<section id="time-plots" class="level3">
<h3 class="anchored" data-anchor-id="time-plots">Time plots</h3>
<p>The simplest graphic for time series is the time series plot, which shows the variable of interest (on the y-axis) against time (on the x-axis). This plot can be created manually with <code>ggplot2</code>, or automatically plotted from the <code>tsibble</code> with <code>autoplot()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fable)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>guinea_rice <span class="sc">|&gt;</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Production)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this plot we can see that <code>Production</code> increases over time (known as <strong>trend</strong>). The increase is mostly smooth but there are a couple anomalies in 2001 and 2008.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Plotting the time variable
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this plot, <code>Production</code> and <code>Year</code> are two continuous variables. We would often like to plot two continuous variables with a scatter plot, however in time-series we prefer to connect the observations from one year to the next to give this line chart.</p>
</div>
</div>
<p>We can also use <code>autoplot()</code> to produce a time plot of many series, but be careful not to plot too many lines at once!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Takings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this plot of Australian accommodation takings, we see that most states have increasing takings over time (upward trend). We can also notice a repeating up and down pattern, which upon closer inspection repeats every year. This repeating annual pattern is known as seasonality, and we can see that some states are more seasonal than others.</p>
<p>Letâ€™s focus on the sunny holiday destination of Queensland, and use different plots to better understand the seasonality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Queensland"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Takings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the <code>tourism</code> dataset, create time plots of the data. Which patterns can you observe?</p>
<p>Some starter code has been provided for you in the day 1 exercises.</p>
<p><em>Hint</em>: there are too many series to show in a single plot, so filter and summarise series of interest to you.</p>
</div>
</div>
</section>
<section id="seasonal-plots" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-plots">Seasonal plots</h3>
<p>It can be tricky to see which quarter has maximum accommodation takings from a time plot. Instead, it is better to use a seasonal plot with <code>gg_season()</code> from feasts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(feasts)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Queensland"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(Takings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here we can see that the Q3 and Q4 takings are higher than Q1 and Q2, this is known as the seasonal peak and trough respectively.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The season plot
</div>
</div>
<div class="callout-body-container callout-body">
<p>The seasonal plot is <em>very</em> similar to the time plot, but the x-axis now wraps over years. This allows us to more easily compare the years and find common patterns, like which month or quarter is biggest and smallest.</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the <code>tourism</code> dataset, create a seasonal plot for the total holiday travel to Australia over time. In which quarter is holiday travel highest and lowest?</p>
<p>Some starter code has been provided for you in the day 1 exercises.</p>
</div>
</div>
</section>
<section id="seasonal-subseries-plot" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-subseries-plot">Seasonal subseries plot</h3>
<p>Another useful plot to understand the seasonal pattern of a time series is the subseries plot, it can be created with <code>gg_subseries()</code>. This plot is splits each month / quarter into separate facets (mini-plots), which shows how the values within each season change over time. The blue lines represent the average, which is a useful way to see the overall seasonality at a glance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Queensland"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(Takings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Seasonal sub-series plots
</div>
</div>
<div class="callout-body-container callout-body">
<p>The upward lines in each facet of this plot shows the trend of the data, however if the lines went in different directions that would imply the shape of the seasonality is changing over time.</p>
<p>Seasonal plots work best after removing trend, which we will see how to do tomorrow!</p>
</div>
</div>
<p>Letâ€™s see this plot with a different dataset, recent beer production in Australia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>aus_beer <span class="ot">&lt;-</span> tsibbledata<span class="sc">::</span>aus_production <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Quarter <span class="sc">&gt;=</span> <span class="fu">yearquarter</span>(<span class="st">"1992 Q1"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Beer)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>aus_beer <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Beer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>At a glance, this looks like the it is very seasonal and has a slight downward trend. However the seasonal subseries plot reveals that the trend is misleading!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>aus_beer <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(Beer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here we see that only Q4 (the peak) has a downward trend, while the other quarters are staying roughly the same. The seasonality is changing shape over time.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Changing seasonality
</div>
</div>
<div class="callout-body-container callout-body">
<p>Look back at the time plot and focus only on the Q4 peaks, can you see these values decreasing over time? Now look at the Q1-Q3 throughs, how do they change over time?</p>
<p>This can be tricky to notice in the time plot, which is why seasonal subseries plots can be particularly helpful!</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the <code>tourism</code> dataset, create a seasonal subseries plot for the total business travel to Victoria over time. Does the seasonal pattern change over time?</p>
<p>Some starter code has been provided for you in the day 1 exercises.</p>
</div>
</div>
</section>
<section id="acf-plots" class="level3">
<h3 class="anchored" data-anchor-id="acf-plots">ACF plots</h3>
<p>These plots may look a bit strange at first, but they are very useful for seeing all of the time series dynamics in a single plot. ACF is the â€˜<strong>a</strong>uto-<strong>c</strong>orrelation <strong>f</strong>unctionâ€™, essentially a measure of how similar a time series is to the lags of itself. Looking at these correlations can reveal trends, seasonality, cycles, and more subtle patterns. You can create an ACF plot using a combination of <code>ACF()</code> and <code>autoplot()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>guinea_rice <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Production) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The rice production of Guinea has an upward trend, which produces a gradual decay in the ACF.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>aus_beer <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Beer) <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The recent beer production of Australia has lots of seasonality and no trend, which creates large peaks at the seasonal lags in the ACF. Every 4 quarters we see a large ACF spike.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>aus_accommodation <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Occupancy =</span> <span class="fu">sum</span>(Occupancy)) <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Occupancy) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The total occupancy of Australiaâ€™s short-term accommodation is both trended and seasonal, which results in a slowly decaying ACF with peaks every seasonal lag (4, 8, 12, â€¦).</p>
<p>Consider the number of Snowshoe Hares which were traded by the Hudson Bay Company.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>tsibbledata<span class="sc">::</span>pelt <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Hare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To the untrained eye, this series has lots of up and down patterns - a bit like seasonality. However this pattern is <strong>cyclical</strong>, not seasonal. The ACF plot can help us distinguish cycles from seasonality.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Seasonal or cyclic?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Seasonality is a consistent repeating pattern, where the shape shape with similar peak and trough repeats at the same time interval.</p>
<p>Cyclical patterns are less consistent, with varying peaks and troughs that repeats over a varied time period.</p>
</div>
</div>
<p>Letâ€™s see the ACF for this dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tsibbledata<span class="sc">::</span>pelt <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Hare) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercises_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice that the peak at lag 10 is less symmetric and â€˜sharpâ€™, this is because the pattern usually repeats every 10 years but sometimes 9 or 11. This is unlike seasonality, which has a sharper peak in the ACF due to the consistent time period between patterns.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Identify which ACF matches the time plots in the following figures by identifying the patterns of trend, seasonality, and cycles in the ACF plots.</p>
<p><img src="acfguess.png" class="img-fluid"></p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the <code>tourism</code> dataset, create an ACF plot for the total travel to Australia over time. Can you identify patterns of trend and seasonality from this plot?</p>
<p>Some starter code has been provided for you in the day 1 exercises.</p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
ACF model evaluation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Importantly, ACF plots can also tell us when there are no patterns/autocorrelations in the data (white noise).</p>
<p>Weâ€™ll be revisiting this plot to evaluate our models on day 5. We hope that a model uses all available information, and ACF plots can show if there is any patterns left over.</p>
</div>
</div>
</section>
</section>
</section>
<section id="apply" class="level1">
<h1>Apply</h1>
<section id="about-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="about-the-dataset">About the dataset</h2>
<p>In this exercise, we use a dataset containing dose of BCG (Cacille Calmette-GuÃ©rin), vaccine administrated in 9 regions of an African country from January 2013 until December 2021. BCG is a widely administered vaccine primarily used to protect against tuberculosis (TB), a serious infection that primarily affects the lungs but can also affect other parts of the body. BCG vaccination is recommended for newborn babies at risk of tuberculosis (TB) and is typically administered shortly after birth, usually within the first 28 days of life.</p>
<p>In addition to the administered dose, it also includes data on the population of children under one year old, and whether a strike occurred in a specific month and region.</p>
<p>In this exercise, you will apply what you have learned about different steps in the forecasting workflow on this dataset.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Import <code>vaccine_adminstrated.csv</code> data into R</p>
<ul>
<li>Check and modify the data types of variables as needed</li>
</ul></li>
<li><p>Prepare your data</p>
<ul>
<li>Check and fix missing values</li>
<li>Check duplications and fix it</li>
<li>Create tsibble</li>
<li>Check and fix temporal gaps</li>
</ul></li>
<li><p>Manipulating time series</p>
<ul>
<li>Create monthly time series of total doses adminstrated in the country</li>
<li>Create quarterly time series of doses adminstrated in each region</li>
<li>Create quarterly time series of total doses adminstrated in the country</li>
</ul></li>
<li><p>Visualizing time series</p>
<ul>
<li>Use time plots and describe what patterns you observe</li>
<li>Create plots to see if any consistent pattern exsists in monthly and quarterly of dose admisntrated</li>
<li>Create plots to see how dose admisntrated chnage over time for each month/quarter and how it differs across differnt month/quarter</li>
</ul></li>
</ol>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<!-- plausible --> 
<script defer="" data-domain="workshop.mitchelloharawild.com" src="https://track.mitchelloharawild.com/js/plausible.js"></script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">This page is built with â¤ï¸ and <a href="https://quarto.org/">Quarto</a>.</div>   
    <div class="nav-footer-right">Â© Copyright 2023, <a href="https://www.f4sg.org/">F4SG</a></div>
  </div>
</footer>



</body></html>